<?php
/** @var \Mirasvit\Profiler\Block\Tab\Sql $block */
use Mirasvit\Profiler\Profile\Database;

$dump = $block->getDump();

/** @var \Mirasvit\Profiler\Helper\Format $format */
$format = $this->helper('Mirasvit\Profiler\Helper\Format');
?>
<div class="metric">
    <strong><?= $format->formatTime($dump[Database::TOTAL_ELAPSED]) ?> ms</strong>
    <i>Total Time</i>
</div>
<div class="metric">
    <strong><?= $dump[Database::TOTAL_QUERIES] ?></strong>
    <i>Total Queries</i>
</div>


<div class="mst-threshold" id="sql-table-threshold">
    <div class="value"></div>
</div>

<?php $idx = 0 ?>
<table id="sql-table" data-threshold="#sql-table-threshold">
    <tr>
        <th>#</th>
        <th>Time (ms)</th>
        <th>SQL Query</th>
        <th>Query Params</th>
    </tr>

    <?php foreach ($dump['profiles'] as $query): ?>
        <tr data-threshold-value="<?= $query[Database::QUERY_ELAPSED] ?>">
            <td class="text-right"><?= ++$idx ?></td>
            <td class="text-right"><?= $format->formatTime($query[Database::QUERY_ELAPSED]) ?></td>
            <td><?= \SqlFormatter::format($query[Database::QUERY]) ?></td>
            <td><?= $format->any($query[Database::QUERY_PARAMS]) ?></td>
        </tr>
    <?php endforeach ?>
</table>

<script>
    //    require([
    //        'jquery',
    //        'Mirasvit_Profiler/js/table'
    //    ], function ($) {
    //        $('#sql-table').profilerTable({});
    //    });
</script>